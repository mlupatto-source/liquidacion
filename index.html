<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Liquidación Marcelo Lupatto</title>
<link rel="manifest" href="manifest.json">

<style>
body{
font-family:Arial;
background:linear-gradient(135deg,#1b5e20,#66bb6a);
padding:20px;
color:#1b5e20;
}
h1{
text-align:center;
color:white;
}
.container{
background:white;
padding:20px;
border-radius:15px;
box-shadow:0 10px 25px rgba(0,0,0,0.2);
}
input,select{
width:100%;
padding:10px;
margin-bottom:12px;
font-size:16px;
border-radius:8px;
border:1px solid #ccc;
}
button{
width:100%;
padding:12px;
margin-top:10px;
border:none;
border-radius:8px;
font-size:16px;
cursor:pointer;
}
.green{
background:#2e7d32;
color:white;
}
.gray{
background:#616161;
color:white;
}
.total{
font-size:24px;
font-weight:bold;
color:black;
margin-top:10px;
}
.label{
font-weight:bold;
margin-bottom:4px;
display:block;
}
</style>
</head>
<body>

<h1>Marcelo Lupatto<br>Liquidación</h1>

<div class="container">

<!-- CLIENTES -->
<label class="label" for="cliente">Cliente</label>
<input type="text" id="cliente" placeholder="Ingrese nombre del cliente">

<!-- FORMA DE COBRO -->
<label class="label" for="formaCobro">Forma de Cobro</label>
<input type="text" id="formaCobro" placeholder="Ingrese forma de cobro">

<!-- TIPO DE HORA -->
<h3>Tipo de Hora</h3>
<select id="tipoHora" onchange="calcular()">
<option value="normal">Hora Normal</option>
<option value="especial">Hora Especial</option>
</select>

Valor Hora Normal:
<input type="number" id="valorHora" value="14000">

Valor Hora Especial:
<input type="number" id="valorHoraEsp" value="18000">

Valor Kilómetro:
<input type="number" id="valorKm" value="600">

Horas:
<input type="number" id="horas" value="0" oninput="calcular()">

Kilómetros:
<input type="number" id="km" value="0" oninput="calcular()">

Otros:
<input type="number" id="otros" value="0" oninput="calcular()">

<div id="total" class="total"></div>

<button class="gray" onclick="reiniciar()">Reiniciar</button>
<button class="green" onclick="generar()">Compartir por WhatsApp</button>
<button onclick="generarPDF()">Generar PDF</button>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
// Guardar y cargar localStorage
function guardarValor(id){
    const el=document.getElementById(id);
    localStorage.setItem(id, el.value);
}
function cargarValor(id){
    const valor=localStorage.getItem(id);
    if(valor!==null){
        document.getElementById(id).value=valor;
    }
}

// Inicializar valores guardados
['cliente','formaCobro','valorHora','valorHoraEsp','valorKm','horas','km','otros'].forEach(cargarValor);

// Calcular total
function formato(n){
    return new Intl.NumberFormat('es-AR').format(n);
}

function obtenerValorHora(){
    let tipo=document.getElementById("tipoHora").value;
    let normal=parseFloat(document.getElementById("valorHora").value)||0;
    let esp=parseFloat(document.getElementById("valorHoraEsp").value)||0;
    return tipo==="normal"?normal:esp;
}

function calcular(){
    let vh=obtenerValorHora();
    let vk=parseFloat(document.getElementById("valorKm").value)||0;
    let h=parseFloat(document.getElementById("horas").value)||0;
    let k=parseFloat(document.getElementById("km").value)||0;
    let o=parseFloat(document.getElementById("otros").value)||0;
    let total=(h*vh)+(k*vk)+o;
    document.getElementById("total").innerHTML="TOTAL: $"+formato(total);

    // Guardar todos los valores
    ['cliente','formaCobro','valorHora','valorHoraEsp','valorKm','horas','km','otros'].forEach(guardarValor);
}

function reiniciar(){
    ['horas','km','otros'].forEach(id=>document.getElementById(id).value=0);
    calcular();
}

// Compartir por WhatsApp
function generar(){
    let fecha=new Date().toLocaleDateString('es-AR');
    let cliente=document.getElementById("cliente").value;
    let h=document.getElementById("horas").value;
    let k=document.getElementById("km").value;
    let o=document.getElementById("otros").value;
    let total=document.getElementById("total").innerText;
    let forma=document.getElementById("formaCobro").value.toUpperCase();

    let texto=
`LIQUIDACION ${fecha} - ${cliente}

HORAS
Cantidad: ${h}

KILÓMETROS
Cantidad: ${k}

${total}

FORMA DE PAGO: ${forma}

Muchas gracias`;

    navigator.share({text:texto});
}

// Generar PDF
async function generarPDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const fecha=new Date().toLocaleDateString('es-AR');
    const cliente=document.getElementById("cliente").value;
    const horas=document.getElementById("horas").value||"0";
    const kilometros=document.getElementById("km").value||"0";
    const total=document.getElementById("total").innerText.replace("TOTAL: $","")||"0";
    const formaPago=document.getElementById("formaCobro").value.toUpperCase();

    // Logo opcional
    const img=new Image();
    img.src="icon.png";
    img.onload=function(){
        doc.addImage(img,"PNG",80,10,50,30);

        doc.setFont("helvetica","bold");
        doc.setFontSize(14);
        doc.text("Marcelo Lupatto",105,50,{align:"center"});

        doc.setFont("helvetica","normal");
        doc.setFontSize(11);

        doc.text("Fecha: "+fecha,20,70);
        doc.text(cliente,105,70,{align:"center"});

        doc.text("HORAS",20,85);
        doc.text("Cantidad: "+horas,25,93);

        doc.text("KILÓMETROS",20,105);
        doc.text("Cantidad: "+kilometros,25,113);

        doc.setFont("helvetica","bold");
        doc.text("TOTAL: $"+formato(total),20,130);

        doc.setFont("helvetica","normal");
        doc.text("FORMA DE PAGO: "+formaPago,20,145);

        doc.save("Liquidacion.pdf");
    };
}

// Ejecutar cálculo inicial
calcular();

</script>
</body>
</html>
