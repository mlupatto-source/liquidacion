<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Liquidación Marcelo Lupatto</title>

<link rel="manifest" href="manifest.json">

<style>
body{
font-family:Arial;
background:linear-gradient(135deg,#1b5e20,#66bb6a);
padding:20px;
color:#1b5e20;
}
h1{
text-align:center;
color:white;
}
.container{
background:white;
padding:20px;
border-radius:15px;
box-shadow:0 10px 25px rgba(0,0,0,0.2);
}
input,select{
width:100%;
padding:10px;
margin-bottom:12px;
font-size:16px;
border-radius:8px;
border:1px solid #ccc;
}
button{
width:100%;
padding:12px;
margin-top:10px;
border:none;
border-radius:8px;
font-size:16px;
cursor:pointer;
}
.green{
background:#2e7d32;
color:white;
}
.gray{
background:#616161;
color:white;
}
.total{
font-size:24px;
font-weight:bold;
color:black;
margin-top:10px;
}
</style>
</head>
<body>

<h1>Marcelo Lupatto<br>Liquidación</h1>

<div class="container">

<h3>Cliente</h3>
<select id="cliente" onchange="guardarSeleccion('cliente')"></select>

<h3>Tipo de Hora</h3>
<select id="tipoHora" onchange="calcular(); guardarSeleccion('tipoHora')">
<option value="normal">Hora Normal</option>
<option value="especial">Hora Especial</option>
</select>

<h3>Forma de Cobro</h3>
<select id="formaSeleccionada" onchange="guardarSeleccion('formaSeleccionada')"></select>

Valor Hora Normal:
<input type="number" id="valorHora" oninput="guardarValor('valorHora')">

Valor Hora Especial:
<input type="number" id="valorHoraEsp" oninput="guardarValor('valorHoraEsp')">

Valor Kilómetro:
<input type="number" id="valorKm" oninput="guardarValor('valorKm')">

Horas:
<input type="number" id="horas" oninput="calcular(); guardarValor('horas')">

Kilómetros:
<input type="number" id="km" oninput="calcular(); guardarValor('km')">

Otros:
<input type="number" id="otros" oninput="calcular(); guardarValor('otros')">

<div id="total" class="total"></div>

<button class="gray" onclick="reiniciar()">Reiniciar</button>
<button class="green" onclick="generar()">Compartir por WhatsApp</button>
<button onclick="generarPDF()">Generar PDF</button>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>

if('serviceWorker' in navigator){
navigator.serviceWorker.register('service-worker.js');
}

function formato(n){
return new Intl.NumberFormat('es-AR').format(n);
}

function guardarValor(id){
localStorage.setItem(id, document.getElementById(id).value);
}

function guardarSeleccion(id){
localStorage.setItem(id, document.getElementById(id).value);
}

function cargarValores(){
let ids=["valorHora","valorHoraEsp","valorKm","horas","km","otros"];
ids.forEach(id=>{
if(localStorage.getItem(id)){
document.getElementById(id).value=localStorage.getItem(id);
}
});
}

function crearSelectEditable(id, cantidad){
let select=document.getElementById(id);
let opciones=JSON.parse(localStorage.getItem(id+"_opciones"))||[];

if(opciones.length===0){
for(let i=1;i<=cantidad;i++){
opciones.push("Opción "+i);
}
localStorage.setItem(id+"_opciones", JSON.stringify(opciones));
}

select.innerHTML="";

opciones.forEach((texto,index)=>{
let opt=document.createElement("option");
opt.value=texto;
opt.textContent=texto;
select.appendChild(opt);
});

if(localStorage.getItem(id)){
select.value=localStorage.getItem(id);
}
}

function editarOpciones(id){
let actuales=JSON.parse(localStorage.getItem(id+"_opciones"));
let nuevas=[];
for(let i=0;i<actuales.length;i++){
let nuevo=prompt("Editar opción "+(i+1), actuales[i]);
if(nuevo) nuevas.push(nuevo);
else nuevas.push(actuales[i]);
}
localStorage.setItem(id+"_opciones", JSON.stringify(nuevas));
crearSelectEditable(id, nuevas.length);
}

function obtenerValorHora(){
let tipo=document.getElementById("tipoHora").value;
let normal=parseFloat(document.getElementById("valorHora").value)||0;
let esp=parseFloat(document.getElementById("valorHoraEsp").value)||0;
return tipo==="normal"?normal:esp;
}

function calcular(){
let vh=obtenerValorHora();
let vk=parseFloat(document.getElementById("valorKm").value)||0;
let h=parseFloat(document.getElementById("horas").value)||0;
let k=parseFloat(document.getElementById("km").value)||0;
let o=parseFloat(document.getElementById("otros").value)||0;
let total=(h*vh)+(k*vk)+o;
document.getElementById("total").innerHTML="TOTAL: $"+formato(total);
}

function reiniciar(){
document.getElementById("horas").value=0;
document.getElementById("km").value=0;
document.getElementById("otros").value=0;
calcular();
}

function generar(){
let fecha=new Date().toLocaleDateString('es-AR');
let cliente=document.getElementById("cliente").value;
let h=document.getElementById("horas").value;
let k=document.getElementById("km").value;
let total=document.getElementById("total").innerText;
let forma=document.getElementById("formaSeleccionada").value;

let texto=
`LIQUIDACION ${fecha}
${cliente}

HORAS
Cantidad: ${h}

KILOMETROS
Cantidad: ${k}

${total}

${forma? "FORMA DE PAGO: "+forma.toUpperCase() : ""}

Muchas gracias`;

navigator.share({text:texto});
}

async function generarPDF(){
const { jsPDF } = window.jspdf;
const doc = new jsPDF();

const fecha=new Date().toLocaleDateString('es-AR');
const cliente=document.getElementById("cliente").value;
const horas=document.getElementById("horas").value;
const km=document.getElementById("km").value;
const total=document.getElementById("total").innerText.replace("TOTAL: ","");
const forma=document.getElementById("formaSeleccionada").value.toUpperCase();

doc.setFont("helvetica","bold");
doc.setFontSize(14);
doc.text("Marcelo Lupatto",105,20,{align:"center"});

doc.setFont("helvetica","normal");
doc.setFontSize(11);

doc.text("Fecha: "+fecha,20,40);
doc.text(cliente,20,48);

doc.text("HORAS",20,65);
doc.text("Cantidad: "+horas,25,73);

doc.text("KILOMETROS",20,85);
doc.text("Cantidad: "+km,25,93);

doc.setFont("helvetica","bold");
doc.text("TOTAL: $"+total,20,110);

doc.setFont("helvetica","normal");
doc.text("FORMA DE PAGO: "+forma,20,125);

doc.save("Liquidacion.pdf");
}

window.onload=function(){
cargarValores();
crearSelectEditable("cliente",5);
crearSelectEditable("formaSeleccionada",5);
if(localStorage.getItem("tipoHora")){
document.getElementById("tipoHora").value=localStorage.getItem("tipoHora");
}
calcular();
};

</script>

</body>
  </html>
